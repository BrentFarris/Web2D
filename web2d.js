{Array.prototype.removeAt=function(e){this.splice(e,1);return this};Array.prototype.remove=function(e){for(var t=0;t<this.length;t++){if(this[t]==e){this.splice(t,1);break}}return this};Array.prototype.clear=function(){this.length=0};Array.prototype.insertAt=function(e,t){var n=this.slice(0,t);var r=this.slice(t);this.clear();for(var i=0;i<n.length;i++)this.push(n[i]);this.push(e);for(var s=0;s<r.length;s++)this.push(r[s]);return this};Array.prototype.contains=function(e){for(var t=0;t<this.length;t++)if(this[t]==e)return true;return false};Array.prototype.occurs=function(e){var t=0;for(var n=0;n<this.length;n++){if(this[n]==e)t++}return t}}
var $Event=function(e){this.events=new Array;this.Register=function(e,t){this.events.push(new Array(e,t==null?window:t))};this.Remove=function(e){for(var t=0;t<this.events.length;t++){if(this.events[t][0]==e){this.events.removeAt(t);break}}};this.Fire=function(e){for(var t=0;t<this.events.length;t++)this.events[t][0].apply(this.events[t][1],e)}}
var $Window=function(){this.GetLeft=function(e){var t=e.offsetLeft;while(e=e.offsetParent)t+=e.offsetLeft;t-=window.pageXOffset;return t};this.GetTop=function(e){var t=e.offsetTop;while(e=e.offsetParent)t+=e.offsetTop;t-=window.pageYOffset;return t}};$Window.onafterprint=new $Event;$Window.onbeforeprint=new $Event;$Window.onbeforeunload=new $Event;$Window.onerror=new $Event;$Window.onhaschange=new $Event;$Window.onload=new $Event;$Window.onmessage=new $Event;$Window.onoffline=new $Event;$Window.ononline=new $Event;$Window.onpagehide=new $Event;$Window.onpageshow=new $Event;$Window.onpopstate=new $Event;$Window.onredo=new $Event;$Window.onresize=new $Event;$Window.onstorage=new $Event;$Window.onunload=new $Event;window.onresize=function(){$Window.Fire([window.innerWidth,window.innerHeight])};window.onafterprint=function(){$Window.onafterprint.Fire()};window.onbeforeprint=function(){$Window.onbeforeprint.Fire()};window.onbeforeunload=function(){$Window.onbeforeunload.Fire()};window.onerror=function(){$Window.onerror.Fire()};window.onhaschange=function(){$Window.onhaschange.Fire()};window.onload=function(){$Window.onload.Fire()};window.onmessage=function(){$Window.onmessage.Fire()};window.onoffline=function(){$Window.onoffline.Fire()};window.ononline=function(){$Window.ononline.Fire()};window.onpagehide=function(){$Window.onpagehide.Fire()};window.onpageshow=function(){$Window.onpageshow.Fire()};window.onpopstate=function(){$Window.onpopstate.Fire()};window.onredo=function(){$Window.onredo.Fire()};window.onresize=function(){$Window.onresize.Fire()};window.onstorage=function(){$Window.onstorage.Fire()};window.onunload=function(){$Window.onunload.Fire()}
var $Document=function(){};$Document.onmousemove=new $Event;$Document.onmousedown=new $Event;$Document.onmouseup=new $Event;$Document.onkeydown=new $Event;$Document.onkeyup=new $Event;document.documentElement.onmousedown=function(e){$Document.onmousedown.Fire()};document.documentElement.onmouseup=function(e){$Document.onmouseup.Fire()};document.documentElement.onmousemove=function(e){e=e||window.event;$Document.onmousemove.Fire([e.clientX,e.clientY])};document.documentElement.onkeydown=function(e){var t;if(window.event)t=window.event.keyCode;else if(e)t=e.which;$Document.onkeydown.Fire([t])};document.documentElement.onkeyup=function(e){var t;if(window.event)t=window.event.keyCode;else if(e)t=e.which;$Document.onkeyup.Fire([t])}
$Vector2=function(e,t){this.x=e==null?0:e;this.y=t==null?0:t;this.Set=function(e){if(e==null)return;this.x=e.x;this.y=e.y};this.Move=function(e){this.x+=vec2.x;this.y+=vec2.y};this.Magnitude=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};this.Dot=function(e){return this.x*e.x+this.y*e.y};this.Cross=function(e){return this.x*e.y-this.y*e.x};this.Normalized=function(){var e=new $Vector2(this.x,this.y);var t=this.Magnitude();e.x=e.x/t;e.y=e.y/t;return e};this.Distance=function(e){return Math.sqrt((vec2.x-this.x)*(vec2.x-this.x)+(this.y-vec2.y)*(this.y-vec2.y))};this.Difference=function(e){new $Vector2(this.x-vec2.x,this.y-vec2.y)};this.Sum=function(e){new $Vector2(this.x+vec2.x,this.y+vec2.y)}};$Color=function(e,t,n,r){this.r=e==null?255:e;this.g=t==null?255:t;this.b=n==null?255:n;this.a=r==null?1:r;this.ToStandard=function(e){if(e==null||!e)return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")";else return"rgb("+this.r+","+this.g+","+this.b+")"}};$Rectangle=function(e,t,n,r,i){this.x=e==null?0:e;this.y=t==null?0:t;this.width=n==null?0:n;this.height=r==null?0:r;console.log(i);this.color=i==null?new $Color:i;this.Contains=function(e,t){return e>=this.x&&e<=this.x+this.width&&t>=this.y&&t<=this.y+this.height};this.Intersects=function(e){var t=0;if(e.radius!=null)t=e.radius;if(this.Contains(e.x-t,e.y-t)||this.Contains(e.x+e.width-t,e.y-t)||this.Contains(e.x-t,e.y+e.height-t)||this.Contains(e.x+e.width-t,e.y+e.height-t)){return true}else if(e.Contains(this.x-t,this.y-t)||e.Contains(this.x+this.width-t,this.y-t)||e.Contains(this.x-t,this.y+this.height-t)||e.Contains(this.x+this.width-t,this.y+this.height-t)){return true}return false};this.Draw=function(e){e.context.fillStyle=this.color.ToStandard();e.context.fillRect(this.x,this.y,this.width,this.height)}}
function InputMousePosition(e,t){input.mousePosition.x=e-input.offset.x;input.mousePosition.y=t-input.offset.y;input.mouseMove.Fire([input.mousePosition.x,input.mousePosition.y])}function InputMouseDown(){input.mouseIsDown=true;input.mouseDown.Fire()}function InputMouseUp(){input.mouseIsDown=false;input.mouseUp.Fire()}function InputKeyDown(e){input.SetKeyDown(e);input.keyDown.Fire(e)}function InputKeyUp(e){input.SetKeyUp(e);input.keyUp.Fire(e)}var KeyString="ABCDEFGHIJKLMNOPQRSTUVWXYZ";var KeyNumberStrings="0123456789";var $Keys=function(){this.tmp=65;for(var e=0;e<KeyString.length;e++){this[KeyString.charAt(e)]=this.tmp++}this.tmp=48;for(var e=0;e<KeyNumberStrings.length;e++){this["Num"+KeyNumberStrings.charAt(e)]=this.tmp++}this.tmp=96;for(var e=0;e<KeyNumberStrings.length;e++){this["Numpad"+KeyNumberStrings.charAt(e)]=this.tmp++}this.Left=37;this.Right=38;this.Up=39;this.Down=40;this.Enter=13;this.Space=32;this.Period=190;this.Comma=188;this.Slash=191;this.Backslash=220;this.Escape=27;this.Backspace=8;this.Backspace=46;this.Shift=16;this.Capslock=20;this.Tab=9;this.Tick=192;this.Ctrl=17;this.Alt=18;this.Add=107;this.Subtract=109;this.Divide=111;this.Multiply=106;this.Decimal=110};var keys=new $Keys;var $Input=function(){this.tmp=65;for(var e=0;e<KeyString.length;e++){this[KeyString.charAt(e)]=false}this.tmp=48;for(var e=0;e<KeyNumberStrings.length;e++){this["num"+KeyNumberStrings.charAt(e)]=false}this.tmp=96;for(var e=0;e<KeyNumberStrings.length;e++){this["numpad"+KeyNumberStrings.charAt(e)]=false}this.left=false;this.right=false;this.up=false;this.down=false;this.enter=false;this.space=false;this.eriod=false;this.comma=false;this.slash=false;this.backslash=false;this.escape=false;this.backspace=false;this.backspace=false;this.shift=false;this.capslock=false;this.tab=false;this.tick=false;this.ctrl=false;this.alt=false;this.add=false;this.subtract=false;this.divide=false;this.multiply=false;this.decimal=false;this.mouseIsDown=false;this.mousePosition=new $Vector2(0);this.offset=new $Vector2(0);this.clamp=new $Vector2(0);this.keyDown=new $Event;this.keyUp=new $Event;this.mouseDown=new $Event;this.mouseUp=new $Event;this.mouseMove=new $Event;this.SetKeyDown=function(e){for(var t=0;t<KeyString.length;t++){if(e==keys[KeyString[t]]){this[KeyString.charAt(t)]=true;return}}for(var t=0;t<KeyNumberStrings.length;t++){if(e==keys["Num"+KeyNumberStrings[t]]){this["Num"+KeyNumberStrings.charAt(t)]=true;return}}for(var t=0;t<KeyNumberStrings.length;t++){if(e==keys["Numpad"+KeyNumberStrings[t]]){this["Numpad"+KeyNumberStrings.charAt(t)]=true;return}}if(e==keys.Left)this.left=true;else if(e==keys.Right)this.right=true;else if(e==keys.Up)this.up=true;else if(e==keys.Down)this.down=true;else if(e==keys.Enter)this.enter=true;else if(e==keys.Space)this.space=true;else if(e==keys.Period)this.period=true;else if(e==keys.Comma)this.comma=true;else if(e==keys.Slash)this.slash=true;else if(e==keys.Backslash)this.backslash=true;else if(e==keys.Escape)this.escape=true;else if(e==keys.Backspace)this.backspace=true;else if(e==keys.Delete)this.delete=true;if(e==keys.Shift)this.shift=true;else if(e==keys.Capslock)this.capslock=true;else if(e==keys.Tab)this.tab=true;else if(e==keys.Tick)this.tick=true;else if(e==keys.Ctrl)this.ctrl=true;else if(e==keys.Alt)this.alt=true;if(e==keys.Add)this.add=true;else if(e==keys.Subtract)this.subtract=true;else if(e==keys.Divide)this.divide=true;else if(e==keys.Multiply)this.multiply=true;else if(e==keys.Decimal)this.decimal=true};this.SetKeyUp=function(e){for(var t=0;t<KeyString.length;t++){if(e==keys[KeyString[t]]){this[KeyString.charAt(t)]=false;return}}for(var t=0;t<KeyNumberStrings.length;t++){if(e==keys["Num"+KeyNumberStrings[t]]){this["Num"+KeyNumberStrings.charAt(t)]=false;return}}for(var t=0;t<KeyNumberStrings.length;t++){if(e==keys["Numpad"+KeyNumberStrings[t]]){this["Numpad"+KeyNumberStrings.charAt(t)]=false;return}}if(e==keys.Left)this.left=false;else if(e==keys.Right)this.right=false;else if(e==keys.Up)this.up=false;else if(e==keys.Down)this.down=false;else if(e==keys.Enter)this.enter=false;else if(e==keys.Space)this.space=false;else if(e==keys.Period)this.period=false;else if(e==keys.Comma)this.comma=false;else if(e==keys.Slash)this.slash=false;else if(e==keys.Backslash)this.backslash=false;else if(e==keys.Escape)this.escape=false;else if(e==keys.Backspace)this.backspace=false;else if(e==keys.Delete)this.delete=false;if(e==keys.Shift)this.shift=false;else if(e==keys.Capslock)this.capslock=false;else if(e==keys.Tab)this.tab=false;else if(e==keys.Tick)this.tick=false;else if(e==keys.Ctrl)this.ctrl=false;else if(e==keys.Alt)this.alt=false;if(e==keys.Add)this.add=false;else if(e==keys.Subtract)this.subtract=false;else if(e==keys.Divide)this.divide=false;else if(e==keys.Multiply)this.multiply=false;else if(e==keys.Decimal)this.decimal=false};this.KeyDown=function(e){return this[letter[0].toUpperCase()]};this.KeyUp=function(e){return!this[letter[0].toUpperCase()]};this.MouseDown=function(){return this.mouseIsDown};this.MouseUp=function(){return!this.mouseIsDown}};var input=new $Input;$Document.onmousemove.Register(InputMousePosition);$Document.onmousedown.Register(InputMouseDown);$Document.onmouseup.Register(InputMouseUp);$Document.onkeydown.Register(InputKeyDown);$Document.onkeyup.Register(InputKeyUp)
var $SpriteSheet=function(e,t,n,r,i,s,o,u,a){this.fps=o==null||o>=33?1:33/o;this.fpsCounter=0;this.width=e;this.height=t;this.rowStart=n;this.columnStart=r;this.row=n;this.column=r;this.rows=a;this.columns=u;this.limit=i==null||i==0?999999999999:i-1;this.limitCount=0;this.position=new $Vector2(0);this.cropPosition=new $Vector2(0);this.image=new Image;if(typeof s=="string")this.image.src=s;else this.image=s;this.SetLimit=function(e){this.limit=l-1};this.SetRow=function(e){this.row=e;this.rowStart=e;this.cropPosition.x=this.width*this.column;this.cropPosition.y=this.height*this.row};this.SetColumn=function(e){this.column=e;this.columnStart=e;this.cropPosition.x=this.width*this.column;this.cropPosition.y=this.height*this.row};this.Draw=function(e){this.cropPosition.x=this.width*this.column;this.cropPosition.y=this.height*this.row;if(this.columns==null||this.columns==0)this.columns=this.image.width/this.width;if(this.rows==null||this.rows==0)this.rows=this.image.height/this.height;if(this.fpsCounter==0){if(this.limitCount<this.limit){this.limitCount++;this.column++;if(this.column>=this.columns){this.row++;this.column=0;if(this.row>=this.rows){this.row=this.rowStart;this.column=this.columnStart;this.limitCount=0}}}else{this.column=this.columnStart;this.row=this.rowStart;this.limitCount=0}}e.context.drawImage(this.image,this.cropPosition.x,this.cropPosition.y,this.width,this.height,this.position.x,this.position.y,this.width,this.height);this.fpsCounter++;if(this.fpsCounter>=this.fps)this.fpsCounter=0}}
function registerCanvas(e,t,n){if(canvas!=null)throw"Canvas already registered";canvas=new $Canvas(e,t,n);canvas.drawing.Register(UpdateRequestId);Start()}function UpdateRequestId(e){requestId=window.requestAnimationFrame(DrawCanvas)}function DrawCanvas(){canvas.context.clearRect(0,0,canvas.elm.width,canvas.elm.height);canvas.Draw()}function Start(){if(canvas==null)throw'You must first register a canvas with the "registerCanvas" function';requestId=window.requestAnimationFrame(DrawCanvas)}function Stop(){if(requestId)window.cancelAnimationFrame(requestId);requestId=0}var $Canvas=function(e,t,n){if(e==="undefined")throw"The canvas id passed was not valid";this.elm=e;this.context=this.elm.getContext("2d");if(t!=null)this.elm.width=document.body.clientWidth*t;if(n!=null)this.elm.height=document.body.clientHeight*n;this.elm.style.width=this.elm.width+"px";this.elm.style.height=this.elm.height+"px";this.drawing=new $Event;this.Draw=function(){this.drawing.Fire([this])}};var canvas=null;var requestId=0;(function(){var e=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;window.requestAnimationFrame=e})()
